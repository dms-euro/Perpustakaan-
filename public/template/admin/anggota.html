<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Manajemen Anggota | Admin</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            emerald: {
              50: '#ecfdf5',
              100: '#d1fae5',
              200: '#a7f3d0',
              300: '#6ee7b7',
              400: '#34d399',
              500: '#10b981',
              600: '#059669',
              700: '#047857',
              800: '#065f46',
              900: '#064e3b',
            }
          }
        }
      }
    }
  </script>

  <!-- AOS Animation -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

  <!-- Boxicons -->
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- Header -->
  <header class="bg-white shadow-sm border-b border-gray-200">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-emerald-700">Manajemen Anggota</h1>
      <button id="addMemberBtn" class="flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white font-medium px-4 py-2 rounded-lg transition">
        <i class='bx bx-plus text-xl'></i>
        <span class="hidden sm:inline">Tambah Anggota</span>
      </button>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Search & Stats -->
    <div class="mb-6 flex flex-col sm:flex-row gap-4" data-aos="fade-up">
      <div class="flex-1">
        <div class="relative">
          <i class='bx bx-search absolute left-3 top-1/2 transform -translate-y-1/2 text-emerald-600'></i>
          <input type="text" id="searchInput" placeholder="Cari nama atau email..."
                 class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent">
        </div>
      </div>
      <div class="bg-emerald-50 border border-emerald-200 rounded-lg px-4 py-2 flex items-center gap-2 text-emerald-800">
        <i class='bx bx-book-open'></i>
        <span class="font-medium">Pinjaman Aktif: <span id="activeLoansCount">0</span></span>
      </div>
    </div>

    <!-- Table -->
    <div class="bg-white rounded-lg shadow overflow-hidden" data-aos="fade-up" data-aos-delay="100">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-emerald-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-emerald-800 uppercase tracking-wider">Nama</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-emerald-800 uppercase tracking-wider">Email</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-emerald-800 uppercase tracking-wider hidden sm:table-cell">Telepon</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-emerald-800 uppercase tracking-wider">Status</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-emerald-800 uppercase tracking-wider">Aksi</th>
            </tr>
          </thead>
          <tbody id="membersTableBody" class="bg-white divide-y divide-gray-200">
            <!-- Data akan diisi via JS -->
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Modal Tambah/Edit Anggota -->
  <div id="memberModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md transform transition-all" data-aos="zoom-in" data-aos-duration="300">
      <div class="flex justify-between items-center p-6 border-b border-gray-200">
        <h3 id="modalTitle" class="text-xl font-semibold text-emerald-800">Tambah Anggota</h3>
        <button id="closeModal" class="text-gray-400 hover:text-gray-600">
          <i class='bx bx-x text-2xl'></i>
        </button>
      </div>
      <form id="memberForm" class="p-6 space-y-4">
        <input type="hidden" id="memberId">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label>
          <input type="text" id="name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <input type="email" id="email" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Telepon</label>
          <input type="tel" id="phone" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
          <select id="status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-500">
            <option value="Aktif">Aktif</option>
            <option value="Nonaktif">Nonaktif</option>
          </select>
        </div>
        <div class="flex justify-end gap-3 pt-4">
          <button type="button" id="cancelBtn" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">Batal</button>
          <button type="submit" class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-md font-medium">Simpan</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Detail Profil & Pinjaman -->
  <div id="detailModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-screen overflow-y-auto transform transition-all" data-aos="zoom-in" data-aos-duration="300">
      <div class="flex justify-between items-center p-6 border-b border-gray-200 sticky top-0 bg-white">
        <h3 class="text-xl font-semibold text-emerald-800">Detail Anggota</h3>
        <button id="closeDetailModal" class="text-gray-400 hover:text-gray-600">
          <i class='bx bx-x text-2xl'></i>
        </button>
      </div>
      <div class="p-6 space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p class="text-sm text-gray-600">Nama</p>
            <p id="detailName" class="font-medium text-gray-900">-</p>
          </div>
          <div>
            <p class="text-sm text-gray-600">Email</p>
            <p id="detailEmail" class="font-medium text-gray-900">-</p>
          </div>
          <div>
            <p class="text-sm text-gray-600">Telepon</p>
            <p id="detailPhone" class="font-medium text-gray-900">-</p>
          </div>
          <div>
            <p class="text-sm text-gray-600">Status</p>
            <p id="detailStatus" class="font-medium">
              <span class="px-2 py-1 text-xs rounded-full" id="statusBadge">-</span>
            </p>
          </div>
        </div>

        <div>
          <h4 class="font-semibold text-emerald-800 mb-3 flex items-center gap-2">
            <i class='bx bx-book-open'></i>
            Riwayat Pinjaman Aktif
          </h4>
          <div id="loanList" class="space-y-3">
            <!-- Daftar pinjaman akan diisi via JS -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init({ once: true });

    // Dummy data anggota
    let members = [
      { id: 1, name: "Ahmad Fauzi", email: "ahmad@example.com", phone: "08123456789", status: "Aktif", activeLoans: 2 },
      { id: 2, name: "Siti Nurhaliza", email: "siti@example.com", phone: "08567891234", status: "Aktif", activeLoans: 1 },
      { id: 3, name: "Budi Santoso", email: "budi@example.com", phone: "08987654321", status: "Nonaktif", activeLoans: 0 },
    ];

    // Dummy pinjaman per anggota
    const loans = {
      1: [
        { title: "Dasar-Dasar Pemrograman Web", borrowDate: "2025-10-20", dueDate: "2025-11-20" },
        { title: "Algoritma dan Struktur Data", borrowDate: "2025-10-25", dueDate: "2025-11-25" }
      ],
      2: [
        { title: "Manajemen Proyek IT", borrowDate: "2025-10-28", dueDate: "2025-11-28" }
      ],
      3: []
    };

    const tableBody = document.getElementById('membersTableBody');
    const searchInput = document.getElementById('searchInput');
    const activeLoansCount = document.getElementById('activeLoansCount');
    const memberModal = document.getElementById('memberModal');
    const detailModal = document.getElementById('detailModal');
    const addMemberBtn = document.getElementById('addMemberBtn');
    const closeModal = document.getElementById('closeModal');
    const cancelBtn = document.getElementById('cancelBtn');
    const memberForm = document.getElementById('memberForm');
    const modalTitle = document.getElementById('modalTitle');

    // Render tabel
    function renderTable(data = members) {
      tableBody.innerHTML = '';
      let totalActive = 0;
      data.forEach(member => {
        totalActive += member.activeLoans;
        const row = `
          <tr class="hover:bg-gray-50 transition">
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${member.name}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${member.email}</td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600 hidden sm:table-cell">${member.phone}</td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span class="px-2 py-1 text-xs rounded-full font-medium ${member.status === 'Aktif' ? 'bg-emerald-100 text-emerald-800' : 'bg-gray-100 text-gray-800'}">
                ${member.status}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
              <button onclick="openDetail(${member.id})" class="text-emerald-600 hover:text-emerald-800">
                <i class='bx bx-clipboard'></i>
              </button>
              <button onclick="editMember(${member.id})" class="text-emerald-600 hover:text-emerald-800">
                <i class='bx bx-edit'></i>
              </button>
              <button onclick="deleteMember(${member.id})" class="text-red-600 hover:text-red-800">
                <i class='bx bx-trash'></i>
              </button>
            </td>
          </tr>`;
        tableBody.innerHTML += row;
      });
      activeLoansCount.textContent = totalActive;
    }

    // Search
    searchInput.addEventListener('input', (e) => {
      const term = e.target.value.toLowerCase();
      const filtered = members.filter(m =>
        m.name.toLowerCase().includes(term) ||
        m.email.toLowerCase().includes(term)
      );
      renderTable(filtered);
    });

    // Tambah anggota
    addMemberBtn.addEventListener('click', () => {
      modalTitle.textContent = 'Tambah Anggota';
      memberForm.reset();
      document.getElementById('memberId').value = '';
      memberModal.classList.remove('hidden');
    });

    // Edit anggota
    window.editMember = (id) => {
      const member = members.find(m => m.id === id);
      modalTitle.textContent = 'Edit Anggota';
      document.getElementById('memberId').value = member.id;
      document.getElementById('name').value = member.name;
      document.getElementById('email').value = member.email;
      document.getElementById('phone').value = member.phone;
      document.getElementById('status').value = member.status;
      memberModal.classList.remove('hidden');
    };

    // Hapus anggota
    window.deleteMember = (id) => {
      Swal.fire({
        title: 'Hapus anggota?',
        text: "Data akan dihapus permanen!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#10b981',
        cancelButtonColor: '#6b7280',
        confirmButtonText: 'Ya, hapus!',
        cancelButtonText: 'Batal'
      }).then((result) => {
        if (result.isConfirmed) {
          members = members.filter(m => m.id !== id);
          renderTable();
          Swal.fire('Terhapus!', 'Anggota telah dihapus.', 'success');
        }
      });
    };

    // Simpan form
    memberForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const id = document.getElementById('memberId').value;
      const newMember = {
        id: id ? parseInt(id) : Date.now(),
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        status: document.getElementById('status').value,
        activeLoans: id ? members.find(m => m.id == id).activeLoans : 0
      };

      if (id) {
        const index = members.findIndex(m => m.id == id);
        members[index] = { ...members[index], ...newMember };
      } else {
        members.push(newMember);
      }

      renderTable();
      memberModal.classList.add('hidden');
      Swal.fire('Sukses!', id ? 'Anggota diperbarui.' : 'Anggota ditambahkan.', 'success');
    });

    // Tutup modal
    closeModal.addEventListener('click', () => memberModal.classList.add('hidden'));
    cancelBtn.addEventListener('click', () => memberModal.classList.add('hidden'));
    document.getElementById('closeDetailModal').addEventListener('click', () => detailModal.classList.add('hidden'));

    // Buka detail
    window.openDetail = (id) => {
      const member = members.find(m => m.id === id);
      document.getElementById('detailName').textContent = member.name;
      document.getElementById('detailEmail').textContent = member.email;
      document.getElementById('detailPhone').textContent = member.phone;
      const statusBadge = document.getElementById('statusBadge');
      statusBadge.textContent = member.status;
      statusBadge.className = `px-2 py-1 text-xs rounded-full font-medium ${member.status === 'Aktif' ? 'bg-emerald-100 text-emerald-800' : 'bg-gray-100 text-gray-800'}`;

      const loanList = document.getElementById('loanList');
      loanList.innerHTML = '';
      const memberLoans = loans[id] || [];
      if (memberLoans.length === 0) {
        loanList.innerHTML = '<p class="text-gray-500 italic">Tidak ada pinjaman aktif.</p>';
      } else {
        memberLoans.forEach(loan => {
          const item = `
            <div class="border border-gray-200 rounded-lg p-4 bg-gray-50">
              <p class="font-medium text-gray-900">${loan.title}</p>
              <p class="text-sm text-gray-600">Dipinjam: ${loan.borrowDate} | Jatuh tempo: ${loan.dueDate}</p>
            </div>`;
          loanList.innerHTML += item;
        });
      }
      detailModal.classList.remove('hidden');
    };

    // Tutup modal saat klik luar
    [memberModal, detailModal].forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.classList.add('hidden');
      });
    });

    // Inisialisasi
    renderTable();
  </script>
</body>
</html>
