<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Buku - Admin Panel</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- AOS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- Flowbite -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet" />
    <!-- Box Icons -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-emerald-50 font-sans">
    <!-- Sidebar -->
    <div class="fixed inset-y-0 left-0 z-50 w-64 bg-emerald-800 transform transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0" id="sidebar">
        <div class="flex items-center justify-between p-4 border-b border-emerald-700">
            <div class="flex items-center space-x-2">
                <i class='bx bx-book-open text-2xl text-emerald-300'></i>
                <span class="text-xl font-bold text-white">Admin Panel</span>
            </div>
            <button class="lg:hidden text-emerald-300" id="close-sidebar">
                <i class='bx bx-x text-2xl'></i>
            </button>
        </div>

        <nav class="p-4 space-y-2">
            <a href="dashboard.html" class="flex items-center space-x-3 p-3 text-emerald-200 hover:bg-emerald-700 rounded-lg transition-colors">
                <i class='bx bx-home text-xl'></i>
                <span class="font-medium">Dashboard</span>
            </a>
            <a href="books.html" class="flex items-center space-x-3 p-3 bg-emerald-700 text-white rounded-lg">
                <i class='bx bx-book text-xl'></i>
                <span class="font-medium">Manajemen Buku</span>
            </a>
            <a href="members.html" class="flex items-center space-x-3 p-3 text-emerald-200 hover:bg-emerald-700 rounded-lg transition-colors">
                <i class='bx bx-group text-xl'></i>
                <span class="font-medium">Manajemen Anggota</span>
            </a>
            <a href="loans.html" class="flex items-center space-x-3 p-3 text-emerald-200 hover:bg-emerald-700 rounded-lg transition-colors">
                <i class='bx bx-transfer text-xl'></i>
                <span class="font-medium">Peminjaman</span>
            </a>
        </nav>

        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-emerald-700">
            <div class="flex items-center space-x-3 p-3 text-emerald-200">
                <div class="w-10 h-10 bg-emerald-600 rounded-full flex items-center justify-center">
                    <i class='bx bx-user text-white'></i>
                </div>
                <div class="flex-1">
                    <p class="font-medium text-white">Admin User</p>
                    <p class="text-sm text-emerald-300">Super Administrator</p>
                </div>
                <button class="text-emerald-300 hover:text-white transition-colors" id="logout-btn">
                    <i class='bx bx-log-out text-xl'></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="lg:ml-64">
        <!-- Top Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="flex items-center justify-between p-4">
                <div class="flex items-center space-x-4">
                    <button class="lg:hidden text-emerald-700" id="open-sidebar">
                        <i class='bx bx-menu text-2xl'></i>
                    </button>
                    <div>
                        <h1 class="text-2xl font-bold text-emerald-900">Edit Buku</h1>
                        <p class="text-sm text-gray-600">Memperbarui informasi buku dalam koleksi</p>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <!-- Back to Detail -->
                    <a href="book-detail.html" class="px-4 py-2 border border-emerald-600 text-emerald-700 rounded-lg hover:bg-emerald-50 transition-colors font-medium flex items-center">
                        <i class='bx bx-arrow-back mr-2'></i>Kembali
                    </a>
                    <!-- Save Button -->
                    <button class="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors font-medium flex items-center" id="save-book-btn">
                        <i class='bx bx-save mr-2'></i>Simpan Perubahan
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="p-6">
            <!-- Book Information -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Left Column - Form -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- Basic Information Card -->
                    <div class="bg-white rounded-2xl shadow-sm p-6" data-aos="fade-up">
                        <h3 class="text-lg font-bold text-emerald-900 mb-4 flex items-center">
                            <i class='bx bx-info-circle mr-2'></i>Informasi Dasar
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Judul Buku *</label>
                                <input type="text" id="book-title" value="Sustainable Future" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="Masukkan judul buku">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Penulis *</label>
                                <input type="text" id="book-author" value="Dr. Michael Green" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="Nama penulis">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ISBN</label>
                                <input type="text" id="book-isbn" value="978-1234567890" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="Nomor ISBN">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Penerbit</label>
                                <input type="text" id="book-publisher" value="Green Publishing" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="Nama penerbit">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tahun Terbit</label>
                                <input type="number" id="book-year" value="2023" min="1900" max="2030" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="Tahun terbit">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Edisi</label>
                                <input type="text" id="book-edition" value="1st Edition" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="Edisi buku">
                            </div>
                        </div>
                    </div>

                    <!-- Category & Classification Card -->
                    <div class="bg-white rounded-2xl shadow-sm p-6" data-aos="fade-up" data-aos-delay="100">
                        <h3 class="text-lg font-bold text-emerald-900 mb-4 flex items-center">
                            <i class='bx bx-category mr-2'></i>Kategori & Klasifikasi
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Kategori Utama *</label>
                                <select id="book-category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                                    <option value="">Pilih Kategori</option>
                                    <option value="sains-teknologi" selected>Sains & Teknologi</option>
                                    <option value="sastra">Sastra</option>
                                    <option value="bisnis-ekonomi">Bisnis & Ekonomi</option>
                                    <option value="sejarah">Sejarah</option>
                                    <option value="filsafat">Filsafat</option>
                                    <option value="kesehatan">Kesehatan</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ID Kategori</label>
                                <input type="text" id="book-category-id" value="CAT-001" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="ID Kategori" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Bahasa</label>
                                <select id="book-language" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                                    <option value="indonesia" selected>Indonesia</option>
                                    <option value="inggris">English</option>
                                    <option value="arab">Arabic</option>
                                    <option value="lainnya">Lainnya</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Tingkat Kesulitan</label>
                                <select id="book-difficulty" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                                    <option value="pemula">Pemula</option>
                                    <option value="menengah" selected>Menengah</option>
                                    <option value="mahir">Mahir</option>
                                    <option value="akademik">Akademik</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Description & Details Card -->
                    <div class="bg-white rounded-2xl shadow-sm p-6" data-aos="fade-up" data-aos-delay="200">
                        <h3 class="text-lg font-bold text-emerald-900 mb-4 flex items-center">
                            <i class='bx bx-file mr-2'></i>Deskripsi & Detail
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Sinopsis</label>
                                <textarea id="book-synopsis" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="Tulis sinopsis buku...">Buku ini membahas tentang masa depan berkelanjutan dengan pendekatan teknologi hijau dan solusi inovatif untuk tantangan lingkungan global. Dr. Michael Green menyajikan pandangan komprehensif tentang bagaimana kita dapat membangun dunia yang lebih baik untuk generasi mendatang.</textarea>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Halaman</label>
                                    <input type="number" id="book-pages" value="320" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="Jumlah halaman">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Berat (gram)</label>
                                    <input type="number" id="book-weight" value="450" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="Berat buku">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Dimensi (cm)</label>
                                    <input type="text" id="book-dimensions" value="23.5 x 15.5 x 2.5" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="P x L x T">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column - Sidebar -->
                <div class="space-y-6">
                    <!-- Book Cover & Status -->
                    <div class="bg-white rounded-2xl shadow-sm p-6" data-aos="fade-left">
                        <h3 class="text-lg font-bold text-emerald-900 mb-4">Sampul Buku</h3>
                        <div class="text-center">
                            <div class="w-32 h-40 bg-emerald-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                                <i class='bx bx-book text-4xl text-emerald-600'></i>
                            </div>
                            <button class="w-full px-4 py-2 border border-emerald-600 text-emerald-700 rounded-lg hover:bg-emerald-50 transition-colors text-sm" id="change-cover-btn">
                                <i class='bx bx-upload mr-2'></i>Unggah Sampul Baru
                            </button>
                            <p class="text-xs text-gray-500 mt-2">Format: JPG, PNG. Maks: 2MB</p>
                        </div>
                    </div>

                    <!-- Inventory & Location -->
                    <div class="bg-white rounded-2xl shadow-sm p-6" data-aos="fade-left" data-aos-delay="100">
                        <h3 class="text-lg font-bold text-emerald-900 mb-4">Inventori & Lokasi</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Total Eksemplar *</label>
                                <input type="number" id="book-copies" value="5" min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Eksemplar Tersedia</label>
                                <input type="number" id="book-available" value="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Lokasi Rak *</label>
                                <input type="text" id="book-location" value="RAK-A-12" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500" placeholder="Kode lokasi">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Status Buku</label>
                                <select id="book-status" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">
                                    <option value="available" selected>Tersedia</option>
                                    <option value="borrowed">Dipinjam</option>
                                    <option value="maintenance">Dalam


                                        baikan</option>
                                    <option value="lost">Hilang</option>
                                    <option value="reference">Referensi</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div class="bg-white rounded-2xl shadow-sm p-6" data-aos="fade-left" data-aos-delay="200">
                        <h3 class="text-lg font-bold text-emerald-900 mb-4">Informasi Tambahan</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">ID Buku</span>
                                <span class="font-medium text-emerald-900">BK-2023-001</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Dibuat Pada</span>
                                <span class="font-medium">15 Jan 2023</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Diupdate Pada</span>
                                <span class="font-medium">20 Des 2023</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Total Peminjaman</span>
                                <span class="font-medium">24 kali</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Rating</span>
                                <div class="flex items-center text-amber-400">
                                    <i class='bx bxs-star'></i>
                                    <span class="text-gray-600 ml-1">4.8/5</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white rounded-2xl shadow-sm p-6" data-aos="fade-left" data-aos-delay="300">
                        <h3 class="text-lg font-bold text-emerald-900 mb-4">Aksi Cepat</h3>
                        <div class="space-y-2">
                            <button class="w-full flex items-center space-x-3 p-3 text-left bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors" id="preview-btn">
                                <i class='bx bx-show text-blue-600 text-xl'></i>
                                <span class="font-medium text-blue-900">Pratinjau Perubahan</span>
                            </button>
                            <button class="w-full flex items-center space-x-3 p-3 text-left bg-amber-50 hover:bg-amber-100 rounded-lg transition-colors" id="history-btn">
                                <i class='bx bx-history text-amber-600 text-xl'></i>
                                <span class="font-medium text-amber-900">Riwayat Perubahan</span>
                            </button>
                            <button class="w-full flex items-center space-x-3 p-3 text-left bg-red-50 hover:bg-red-100 rounded-lg transition-colors" id="delete-book-btn">
                                <i class='bx bx-trash text-red-600 text-xl'></i>
                                <span class="font-medium text-red-900">Hapus Buku</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="mt-6 flex justify-end space-x-4">
                <a href="book-detail.html" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium">
                    Batal
                </a>
                <button class="px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors font-medium flex items-center" id="update-book-btn">
                    <i class='bx bx-check-circle mr-2'></i>Perbarui Buku
                </button>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>
    <script>
        // Initialize AOS
        AOS.init({
            duration: 800,
            once: true,
            offset: 100
        });

        // Sidebar functionality
        const sidebar = document.getElementById('sidebar');
        const openSidebar = document.getElementById('open-sidebar');
        const closeSidebar = document.getElementById('close-sidebar');

        openSidebar.addEventListener('click', () => {
            sidebar.classList.remove('-translate-x-full');
        });

        closeSidebar.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
        });

        // Logout functionality
        document.getElementById('logout-btn').addEventListener('click', () => {
            Swal.fire({
                title: 'Konfirmasi Logout',
                text: 'Apakah Anda yakin ingin keluar dari panel admin?',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ya, Logout',
                cancelButtonText: 'Batal',
                confirmButtonColor: '#10b981'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = 'login.html';
                }
            });
        });

        // Update Book Functionality
        document.getElementById('update-book-btn').addEventListener('click', updateBook);
        document.getElementById('save-book-btn').addEventListener('click', updateBook);

        function updateBook() {
            const bookData = {
                title: document.getElementById('book-title').value,
                author: document.getElementById('book-author').value,
                isbn: document.getElementById('book-isbn').value,
                publisher: document.getElementById('book-publisher').value,
                year: document.getElementById('book-year').value,
                edition: document.getElementById('book-edition').value,
                category: document.getElementById('book-category').value,
                category_id: document.getElementById('book-category-id').value,
                language: document.getElementById('book-language').value,
                difficulty: document.getElementById('book-difficulty').value,
                synopsis: document.getElementById('book-synopsis').value,
                pages: document.getElementById('book-pages').value,
                weight: document.getElementById('book-weight').value,
                dimensions: document.getElementById('book-dimensions').value,
                copies: document.getElementById('book-copies').value,
                location: document.getElementById('book-location').value,
                status: document.getElementById('book-status').value
            };

            // Validation
            if (!bookData.title || !bookData.author || !bookData.category || !bookData.copies || !bookData.location) {
                Swal.fire('Error!', 'Harap isi semua field yang wajib diisi (*).', 'error');
                return;
            }

            // Show loading
            Swal.fire({
                title: 'Memperbarui Buku...',
                text: 'Sedang menyimpan perubahan',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });

            // Simulate API call
            setTimeout(() => {
                Swal.fire({
                    title: 'Berhasil!',
                    text: `Buku "${bookData.title}" berhasil diperbarui.`,
                    icon: 'success',
                    confirmButtonText: 'OK',
                    confirmButtonColor: '#10b981'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Redirect back to detail page
                        window.location.href = 'book-detail.html';
                    }
                });
            }, 1500);
        }

        // Delete Book Functionality
        document.getElementById('delete-book-btn').addEventListener('click', function() {
            const bookTitle = document.getElementById('book-title').value;

            Swal.fire({
                title: 'Hapus Buku?',
                html: `
                    <div class="text-left">
                        <p>Anda akan menghapus buku: <strong>"${bookTitle}"</strong></p>
                        <div class="mt-3 bg-red-50 border border-red-200 rounded-lg p-3">
                            <p class="text-sm text-red-700">
                                <i class='bx bx-error mr-1'></i>
                                Tindakan ini tidak dapat dibatalkan. Semua data buku akan dihapus permanen.
                            </p>
                        </div>
                        <div class="mt-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="confirm-delete" class="rounded border-gray-300 text-red-600 focus:ring-red-500">
                                <span class="ml-2 text-sm text-gray-700">Ya, saya yakin ingin menghapus buku ini</span>
                            </label>
                        </div>
                    </div>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Hapus Permanen',
                cancelButtonText: 'Batal',
                confirmButtonColor: '#d33',
                reverseButtons: true,
                preConfirm: () => {
                    if (!document.getElementById('confirm-delete').checked) {
                        Swal.showValidationMessage('Harap konfirmasi penghapusan');
                        return false;
                    }
                    return true;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // Show deleting progress
                    Swal.fire({
                        title: 'Menghapus...',
                        text: 'Sedang menghapus buku dari sistem',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });

                    setTimeout(() => {
                        Swal.fire({
                            title: 'Terhapus!',
                            text: `Buku "${bookTitle}" telah berhasil dihapus.`,
                            icon: 'success',
                            confirmButtonText: 'Kembali ke Daftar Buku',
                            confirmButtonColor: '#10b981'
                        }).then(() => {
                            window.location.href = 'books.html';
                        });
                    }, 1500);
                }
            });
        });

        // Change Cover Functionality
        document.getElementById('change-cover-btn').addEventListener('click', function() {
            Swal.fire({
                title: 'Ubah Sampul Buku',
                html: `
                    <div class="text-center">
                        <div class="w-32 h-40 bg-emerald-100 rounded-lg flex items-center justify-center mx-auto mb-4">
                            <i class='bx bx-book text-4xl text-emerald-600'></i>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Pilih gambar baru untuk sampul buku</p>
                        <input type="file" id="cover-upload" class="w-full px-3 py-2 border border-gray-300 rounded-lg" accept="image/*">
                        <div class="mt-4 text-left">
                            <p class="text-xs text-gray-500">• Format yang didukung: JPG, PNG, WebP</p>
                            <p class="text-xs text-gray-500">• Ukuran maksimal: 2MB</p>
                            <p class="text-xs text-gray-500">• Rasio disarankan: 3:4</p>
                        </div>
                    </div>
                `,
                showCancelButton: true,
                confirmButtonText: 'Unggah',
                cancelButtonText: 'Batal',
                confirmButtonColor: '#10b981',
                preConfirm: () => {
                    const fileInput = document.getElementById('cover-upload');
                    if (!fileInput.files[0]) {
                        Swal.showValidationMessage('Harap pilih file gambar');
                        return false;
                    }

                    const file = fileInput.files[0];
                    if (file.size > 2 * 1024 * 1024) {
                        Swal.showValidationMessage('Ukuran file maksimal 2MB');
                        return false;
                    }

                    if (!['image/jpeg', 'image/png', 'image/webp'].includes(file.type)) {
                        Swal.showValidationMessage('Format file harus JPG, PNG, atau WebP');
                        return false;
                    }

                    return file;
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // Simulate upload process
                    Swal.fire({
                        title: 'Mengunggah...',
                        text: 'Sedang mengunggah gambar sampul',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });

                    setTimeout(() => {
                        Swal.fire('Berhasil!', 'Sampul buku berhasil diubah.', 'success');
                    }, 1000);
                }
            });
        });

        // Auto-calculate available copies based on status
        document.getElementById('book-copies').addEventListener('input', updateAvailableCopies);
        document.getElementById('book-status').addEventListener('change', updateAvailableCopies);

        function updateAvailableCopies() {
            const totalCopies = parseInt(document.getElementById('book-copies').value) || 0;
            const status = document.getElementById('book-status').value;

            let availableCopies = totalCopies;

            // Adjust available copies based on status
            if (status === 'maintenance' || status === 'lost') {
                availableCopies = 0;
            } else if (status === 'borrowed') {
                // Simulate some copies are borrowed
                availableCopies = Math.max(0, totalCopies - 2);
            }

            document.getElementById('book-available').value = availableCopies;
        }

        // Initialize available copies on page load
        updateAvailableCopies();

        // Preview Changes
        document.getElementById('preview-btn').addEventListener('click', function() {
            const bookData = {
                title: document.getElementById('book-title').value,
                author: document.getElementById('book-author').value,
                category: document.getElementById('book-category').options[document.getElementById('book-category').selectedIndex].text,
                status: document.getElementById('book-status').options[document.getElementById('book-status').selectedIndex].text
            };

            Swal.fire({
                title: 'Pratinjau Perubahan',
                html: `
                    <div class="text-left space-y-3">
                        <div class="bg-emerald-50 p-4 rounded-lg">
                            <h4 class="font-bold text-emerald-900 mb-2">Perubahan yang akan disimpan:</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Judul:</span>
                                    <span class="font-medium">${bookData.title}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Penulis:</span>
                                    <span class="font-medium">${bookData.author}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Kategori:</span>
                                    <span class="font-medium">${bookData.category}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Status:</span>
                                    <span class="font-medium">${bookData.status}</span>
                                </div>
                            </div>
                        </div>
                        <p class="text-sm text-gray-600">Pastikan semua informasi sudah benar sebelum menyimpan.</p>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'Lanjutkan Edit',
                confirmButtonColor: '#10b981',
                showCancelButton: true,
                cancelButtonText: 'Simpan Sekarang'
            }).then((result) => {
                if (!result.isConfirmed) {
                    updateBook();
                }
            });
        });

        // History Button
        document.getElementById('history-btn').addEventListener('click', function() {
            Swal.fire({
                title: 'Riwayat Perubahan',
                html: `
                    <div class="text-left">
                        <div class="space-y-3 max-h-60 overflow-y-auto">
                            <div class="p-3 bg-gray-50 rounded-lg">
                                <div class="flex justify-between items-start mb-1">
                                    <span class="font-medium text-sm">Diperbarui oleh Admin</span>
                                    <span class="text-xs text-gray-500">20 Des 2023, 14:30</span>
                                </div>
                                <p class="text-xs text-gray-600">Mengubah jumlah eksemplar dari 3 menjadi 5</p>
                            </div>
                            <div class="p-3 bg-gray-50 rounded-lg">
                                <div class="flex justify-between items-start mb-1">
                                    <span class="font-medium text-sm">Diperbarui oleh Admin</span>
                                    <span class="text-xs text-gray-500">15 Nov 2023, 10:15</span>
                                </div>
                                <p class="text-xs text-gray-600">Memperbarui lokasi rak ke A-12</p>
                            </div>
                            <div class="p-3 bg-gray-50 rounded-lg">
                                <div class="flex justify-between items-start mb-1">
                                    <span class="font-medium text-sm">Dibuat oleh Admin</span>
                                    <span class="text-xs text-gray-500">15 Jan 2023, 09:00</span>
                                </div>
                                <p class="text-xs text-gray-600">Buku ditambahkan ke sistem</p>
                            </div>
                        </div>
                    </div>
                `,
                confirmButtonText: 'Tutup',
                confirmButtonColor: '#10b981',
                width: 500
            });
        });

        // Form change detection
        let formChanged = false;
        const formInputs = document.querySelectorAll('input, select, textarea');

        formInputs.forEach(input => {
            input.addEventListener('input', () => {
                formChanged = true;
            });
        });

        // Warn before leaving if there are unsaved changes
        window.addEventListener('beforeunload', (e) => {
            if (formChanged) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

        // Handle back to detail link
        document.querySelector('a[href="book-detail.html"]').addEventListener('click', (e) => {
            if (formChanged) {
                e.preventDefault();
                Swal.fire({
                    title: 'Perubahan Belum Disimpan',
                    text: 'Anda memiliki perubahan yang belum disimpan. Yakin ingin keluar?',
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Ya, Keluar',
                    cancelButtonText: 'Tetap di Halaman',
                    confirmButtonColor: '#d33'
                }).then((result) => {
                    if (result.isConfirmed) {
                        window.location.href = 'book-detail.html';
                    }
                });
            }
        });
    </script>
</body>
</html>
